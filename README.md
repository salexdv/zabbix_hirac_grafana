# Zabbix + Grafana для мониторинга кластеров 1С через [HiRAC](https://github.com/arkuznetsov/hirac)

![Мониторинг](https://github.com/salexdv/git_images/blob/master/zbx_grf_hirac_grafana.png?raw=true)

## Описание

Набор контейнеров для запуска в Docker для организации мониторинга. В контейнерах запускается только Zabbix и Grafana. Выбор версии 5.2 для zabbix обусловлен тем, что это последняя версия, в которой есть группы элементов данных. В последних версиях их заменили теги, которые кажутся менее удобными.

![Группировка элементов](https://github.com/salexdv/git_images/blob/master/zbx_grf_hirac_zabbix.png?raw=true)

## Запуск

### Zabbix+Grafana

```bash
docker-compose up -d
```

* После успешного запуска веб-интерфейс Zabbix будет доступна по адресу [http://localhost:8080](http://localhost:8080)
* Веб-интерфейс Grafana будет доступен по адресу [http://localhost:3000](http://localhost:3000)

### HiRAC

Процесс установки и запуска HiRAC описан в его [документации](https://github.com/arkuznetsov/hirac)

## Использование, настройки

### Zabbix

* В zabbix следует загрузить шаблон [`1C Cluster`](templates/zabbix/zbx_export_templates.json)
* Создать новый узел с именем `1c host`, присвоить ему группу `1C Servers` и добавить к нему шаблон `1C Cluster`.
* Задать в качестве значения для унаследованного макроса `{$HIRAC_ADDRESS}` адрес HiRAC

Имя узла, конечно, может быть произвольным. Здесь оно задано явно, чтобы не было проблем с шаблоном grafana т.к. значение `1c host` используется там для фильтрации данных. Этот момент можно переделать, если необходимо мониторить несколько кластеров 1С. В последних версиях zabbix шаблон тоже работает, но вместо групп элементов данных будут теги с такими же наименованиями. Логин и пароль по умолчанию для веб-интерфейса `Admin/zabbix`

### Grafana

* Добавить новый источник данных `MySQL` со значением хоста `mysql-server`. Имя базы данных, а также логин/пароль из файла [.env_db_mysql](env_vars/.env_db_mysql)
* Активировать уже установленный плагин `Zabbix`
* Добавить новый источник данных `Zabbix` со значением URL `http://zabbix-web-nginx-mysql:8080/api_jsonrpc.php`. Логин и пароль такие же, как в веб-интерфейсе zabbix
* Включить `Direct DB Connection` и выбрать в качестве источника ранее созданный MySQL
* Импортировать шаблон панели из файла [`cluster_dashboard`](templates/grafana/cluster_dashboard.json)

Логин и пароль по умолчанию для веб-интерфейса `admin/admin`

## Мониторинг

Вышеупомянутые шаблоны предоставляют возможность собирать базовую информацию о работе кластера, а также позволяют получить простую визуализацию данной информации. В представленных шаблонах нет триггеров для проблемных ситуаций, нет автообнаружения высокой нагрузки и нет оповещений. Всё это настраивается индивидуально.
